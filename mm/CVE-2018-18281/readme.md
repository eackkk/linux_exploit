*原文：https://googleprojectzero.blogspot.com/2019/01/taking-page-from-kernels-book-tlb-issue.html*

*参考：https://www.iceswordlab.com/2019/03/08/cve-2018-18281/*

### TLB

### race 技巧：抢占和CPU优先级

linux内核支持三种不同的抢占模型，必须在build时选择一种：

- CONFIG_PREEMPT_NONE(无强迫抢占(服务器))
- CONFIG_PREEMPT_VOLUNTARY(自愿内核抢占(桌面))
- CONFIG_PREEMPT(内核可抢占(低延迟桌面))

其中，Pixel 6 和 Huawei Mate50 pro 的内核配置都设置为 CONFIG_PREEMPT：

![image](https://github.com/eackkk/linux_exploit/assets/73926435/2df701e1-b281-4f3d-ac9e-253a0841375b)

这意味着，当内核存在一个race漏洞时，可以将指定进程踢出当前的CPU核，让进程远离CPU一段时间，从而扩大被race的时间窗口，linux内核提供了操作调度的相关API：

- sched_setaffinity：设置进程在哪个或者哪几个CPU核心上运行

- sched_setscheduler：为指定的pid设置调度策略policy和参数param

